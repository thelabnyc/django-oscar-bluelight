{% extends 'dashboard/layout.html' %}

{% load currency_filters %}

{% load i18n %}

{% block body_class %}{{ block.super }} create-page{% endblock %}

{% block title %}
    {% if condition.pk %}
        {{ condition.name }}:
    {% else %}
        {% trans "Create new condition" %}:
    {% endif %}
    {{ title }} | {% trans "Conditions" %} | {{ block.super }}
{% endblock %}

{% block breadcrumbs %}
<ul class="breadcrumb">
    <li>
        <a href="{% url 'dashboard:index' %}">{% trans "Dashboard" %}</a>
    </li>
    <li>
        <a href="{% url 'dashboard:condition-list' %}">{% trans "Conditions" %}</a>
    </li>
    {% if condition.pk %}
        <li>
            <a href="{% url 'dashboard:condition-update' pk=condition.pk %}">{{ condition.name }}</a>
        </li>
    {% else %}
        <li>
            {% trans "Create new condition" %}
        </li>
    {% endif %}
</ul>
{% endblock %}

{% block headertext %}
    {% if not condition.pk %}
        {% trans "Create new condition" %}
    {% else %}
        {{ condition.name }}
    {% endif %}
{% endblock %}

{% block dashboard_content %}
    <div class="row">
        <div class="col-md-offset-1 col-md-6">
            <form action="." method="post" class="form-stacked wysiwyg fixed-actions">
                <div class="table-header">
                    <h3>{% trans "Details" %}</h3>
                </div>
                <div class="well">
                    {% csrf_token %}
                    <p>{% trans "Fields marked with * are mandatory." %}</p>

                    {% block form_fields %}
                        {% include "dashboard/partials/form_field.html" with field=form.range %}
                        <p>
                            {% url 'dashboard:range-list' as range_list_url %}
                            {% blocktrans %}
                            Ranges can be created and edited from within the <a href="{{ range_list_url }}">range dashboard</a>.
                            {% endblocktrans %}
                        </p>

                        {% include "dashboard/partials/form_field.html" with field=form.type %}
                        {% include "dashboard/partials/form_field.html" with field=form.value %}
                    {% endblock %}
                </div>

                <div class="fixed-actions-group">
                    <div class="form-actions">
                        <div class="pull-right">
                            <button class="btn btn-default" name="save" type="submit" data-loading-text="{% trans 'Saving...' %}">{% trans "Save" %}</button>
                        </div>
                        <a class="btn btn-default" href="{% url 'dashboard:condition-list' %}">{% trans "Cancel" %}</a>
                        {% if condition.pk %}
                            <a class="btn btn-danger" href="{% url 'dashboard:condition-delete' pk=condition.pk %}">{% trans "Delete" %}</a></li>
                        {% endif %}
                    </div>
                </div>
            </form>
        </div>
        {% if condition.conditionaloffer_set.count %}
            <div class="col-md-4">
                <div class="table-header">
                    <h3>{% trans "Used by Offers" %}</h3>
                </div>
                <div class="well">
                    <ul>
                        {% for offer in condition.conditionaloffer_set.all %}
                            <li><a href="{% url 'dashboard:offer-detail' pk=offer.pk %}">{{ offer.name }}</a></li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        {% endif %}
    </div>
{% endblock dashboard_content %}
