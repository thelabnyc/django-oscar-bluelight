{% extends 'dashboard/layout.html' %}

{% load currency_filters %}
{% load sorting_tags %}
{% load i18n %}

{% block title %}
    {% trans "Offer Groups" %} | {{ block.super }}
{% endblock %}

{% block breadcrumbs %}
    <ul class="breadcrumb">
        <li>
            <a href="{{ homepage_url }}">{% trans "Dashboard" %}</a>
        </li>
        <li class="active">{% trans "Offer Groups" %}</li>
    </ul>
{% endblock %}

{% block header %}
    <div class="page-header">
        <p class="pull-right">
            <a href="{% url 'dashboard:offergroup-create' %}" class="btn btn-primary btn-lg"><i class="icon-plus"></i> {% trans "Create new Offer Group" %}</a>
        </p>
        <h1>{% trans "Offer Groups" %}</h1>
    </div>
{% endblock header %}

{% block dashboard_content %}
    <form action="." method="post" class="order_table">
        {% csrf_token %}
        <table class="table table-striped table-bordered">
            <caption>
                <i class="icon-gift icon-large"></i>{{ queryset_description }}
                {% if is_filtered %}
                    <a href="{% url 'dashboard:offergroup-list' %}" >{% trans "Reset" %}</a>
                {% endif %}
            </caption>
            {% if object_list %}
                <tr>
                    <th>{% trans 'Name' %}</th>
                    <th>{% trans 'Priority' %}</th>
                    <th>{% trans 'Contains Offers' %}</th>
                    <th>{% trans 'Actions' %}</th>
                </tr>
                {% for offergroup in object_list %}
                    <tr class="offergroup">
                        <td><a href="{% url 'dashboard:offergroup-update' pk=offergroup.pk %}">{{ offergroup.name|default:"-" }}</a></td>
                        <td>{{ offergroup.priority }}</td>
                        <td>
                            <ol>
                                {% for offer in offergroup.offers.all %}
                                    {% for voucher in offer.vouchers.exclude_children.all %}
                                        <li class="offergroup__voucher {% if not voucher.is_active or not offer.is_available %}offergroup__voucher--inactive{% endif %}">
                                            <a href="{% url 'dashboard:voucher-stats' pk=voucher.pk %}">{{ voucher.name }} (priority {{ offer.priority }})</a>
                                            <span class="label label-success">{% trans "Voucher" %}</span>
                                        </li>
                                    {% empty %}
                                        <li class="offergroup__offer {% if not offer.is_available %}offergroup__offer--inactive{% endif %}">
                                            <a href="{% url 'dashboard:offer-detail' pk=offer.pk %}">{{ offer.name }} (priority {{ offer.priority }})</a>
                                            <span class="label label-info">{% trans "Offer" %}</span>
                                        </li>
                                    {% endfor %}
                                {% endfor %}
                            </ol>
                            <ol>
                                {% for voucher in offergroup.voucher_set.all %}
                                    <li><a href="{% url 'dashboard:voucher-stats' pk=voucher.pk %}">voucher: {{ voucher.name }}</a></li>
                                {% endfor %}
                            </ol>
                        </td>
                        <td>
                            <div class="btn-toolbar">
                                <div class="btn-group">
                                    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="true">
                                        {% trans "Actions" %}
                                        <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu pull-right">
                                        <li>
                                            <a href="{% url 'dashboard:offergroup-update' pk=offergroup.pk %}">{% trans "Edit" %}</a>
                                        </li>
                                        <li {% if offergroup.offers.exists %} class="disabled" title="Remove all offers from this group to delete it" {% endif %}>
                                            <a href="{% url 'dashboard:offergroup-delete' pk=offergroup.pk %}">{% trans "Delete" %}</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </td>
                    </tr>
                {% endfor %}

            {% else %}
                <tr><td>{% trans "No Offer Groups found." %}</td></tr>
            {% endif %}
        </table>
        {% include "dashboard/partials/pagination.html" %}
    </form>
    <style type="text/css">
        .offergroup .offergroup__voucher--inactive,
        .offergroup .offergroup__offer--inactive {
            opacity: 0.3;
        }
    </style>
{% endblock dashboard_content %}
