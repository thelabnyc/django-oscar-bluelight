!function(){var e,t={225:function(e,t,r){"use strict";r(9848);var o=r(329),n=r(2241),a=r(1635),l=r(1257),s=r.n(l),i=r(7423),c=r.n(i);const u=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.sH)(void 0,[...t],void 0,(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/dashboard/offers/api/offergroups/",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return function*(){return(yield c().get(e).query({offers_page:t,offers_page_size:200}).set("Accept","application/json")).body.map((e=>Object.assign(Object.assign({},e),{current_offers_page:t,has_more_offers:e.total_offers_count>200*t})))}()}))};class f extends o.Component{constructor(e){super(e),this.onLoadMoreOffers=e=>(0,a.sH)(this,void 0,void 0,(function*(){var t;if(!this.state.isLoadingMoreForGroup.includes(e)){this.setState((t=>({isLoadingMoreForGroup:[...t.isLoadingMoreForGroup,e]})));try{const r=((null===(t=this.state.groups.find((t=>t.id===e)))||void 0===t?void 0:t.current_offers_page)||1)+1,o=yield u(this.props.endpoint,r);this.setState((t=>{const n=[...t.groups],a=n.findIndex((t=>t.id===e)),l=n[a];return n[a]=Object.assign(Object.assign({},l),{offers:[...l.offers,...o[a].offers],current_offers_page:r,has_more_offers:o[a].has_more_offers}),{isLoadingMoreForGroup:t.isLoadingMoreForGroup.filter((t=>t!==e)),groups:n}}))}catch(e){console.error("Failed to load more offers:",e)}this.setState((t=>({isLoadingMoreForGroup:t.isLoadingMoreForGroup.filter((t=>t!==e))})))}})),this.state={isLoading:!0,isLoadingMoreForGroup:[],groups:[]}}componentDidMount(){(()=>(0,a.sH)(this,void 0,void 0,(function*(){const e=yield u(this.props.endpoint);this.setState({isLoading:!1,isLoadingMoreForGroup:[],groups:e})})))().catch(console.log)}buildGroupActions(e){const t=e.offers.length>0,r=e.is_system_group,n=t||r?"disabled":"";let a,l;return r?a=gettext("System groups can not be deleted."):t?a=gettext("Remove all offers from this group to delete it."):(a=interpolate(gettext("Delete the %s offer group"),[e.name]),l=e.delete_link),o.createElement("div",{className:"btn-toolbar"},o.createElement("div",{className:"dropdown"},o.createElement("button",{className:"btn btn-secondary dropdown-toggle",type:"button","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},gettext("Actions")),o.createElement("ul",{className:"dropdown-menu dropdown-menu-right"},o.createElement("a",{className:"dropdown-item",href:e.update_link,title:interpolate(gettext("Edit the details of the %s offer group"),[e.name])},gettext("Edit")),o.createElement("a",{className:`dropdown-item ${n}`,title:a,href:l},gettext("Delete")))))}buildBooleanLabel(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e)return o.createElement("span",{className:"label label-success"},gettext("Yes"));const r=t?"label-danger":"label-default";return o.createElement("span",{className:`label ${r}`},gettext("No"))}buildOfferRow(e,t){const r=s()({offergroup__offer:!0,"offergroup__offer--inactive":!t.is_available});return o.createElement("tr",{key:`offer-${t.id}`,className:r},o.createElement("td",{className:"offergroup__offer__index"},o.createElement("a",{href:t.details_link},e)),o.createElement("td",{className:"offergroup__offer__name"},o.createElement("a",{href:t.details_link},t.name)),o.createElement("td",{className:"offergroup__offer__priority"},t.priority),o.createElement("td",{className:"offergroup__offer__type"},o.createElement("span",{className:"label label-info"},gettext("Offer"))))}buildVoucherRow(e,t){return t.vouchers.map((r=>{const n=s()({offergroup__voucher:!0,"offergroup__voucher--inactive":!r.is_active});return o.createElement("tr",{key:`voucher-${r.id}`,className:n},o.createElement("td",{className:"offergroup__voucher__index"},o.createElement("a",{href:r.details_link},e)),o.createElement("td",{className:"offergroup__voucher__name"},o.createElement("a",{href:r.details_link},r.name)),o.createElement("td",{className:"offergroup__voucher__priority"},t.priority),o.createElement("td",{className:"offergroup__voucher__type"},o.createElement("span",{className:"label label-success"},gettext("Voucher"))))}))}buildOfferList(e){const t=e.offers.filter((e=>!("Voucher"===e.offer_type&&e.vouchers.length<=0))).map(((e,t)=>{const r=t+1;return e.vouchers.length>0?this.buildVoucherRow(r,e):this.buildOfferRow(r,e)}));return o.createElement(o.Fragment,null,o.createElement("table",{className:"table table-bordered table-striped offergroup-subtable"},o.createElement("caption",null,e.name),o.createElement("thead",null,o.createElement("tr",null,o.createElement("th",{className:"offergroup__offer__index"},gettext("#")),o.createElement("th",{className:"offergroup__offer__name"},gettext("Name")),o.createElement("th",{className:"offergroup__offer__priority"},gettext("Priority")),o.createElement("th",{className:"offergroup__offer__type"},gettext("Type")))),o.createElement("tbody",null,t)),e.has_more_offers&&o.createElement("button",{onClick:()=>this.onLoadMoreOffers(e.id),disabled:this.state.isLoadingMoreForGroup.includes(e.id),className:"btn btn-block btn-primary"},gettext("Load More Offers")))}buildGroupRows(){return this.state.isLoading?o.createElement("tr",null,o.createElement("td",{colSpan:5,className:"offergroup__empty"},gettext("Loadingâ€¦"))):this.state.groups.length<=0?o.createElement("tr",null,o.createElement("td",{colSpan:5,className:"offergroup__empty"},gettext("No Offer Groups found."))):this.state.groups.map((e=>o.createElement("tr",{key:e.id,"data-group-slug":e.slug},o.createElement("td",null,e.name),o.createElement("td",null,this.buildBooleanLabel(e.is_system_group)),o.createElement("td",null,e.priority),o.createElement("td",{className:"subtable-container"},this.buildOfferList(e)),o.createElement("td",null,this.buildGroupActions(e)))))}render(){return o.createElement("table",{className:"table table-bordered"},o.createElement("caption",null,o.createElement("i",{className:"fas fa-gift"})),o.createElement("tbody",null,o.createElement("tr",null,o.createElement("th",null,gettext("Name")),o.createElement("th",null,gettext("Is System Group?")),o.createElement("th",null,gettext("Priority")),o.createElement("th",null,gettext("Group Contents")),o.createElement("th",null,gettext("Actions"))),this.buildGroupRows()))}}var d=f;!function(){const e=document.querySelector("#offergroup-table");(0,n.H)(e).render(o.createElement(d,{endpoint:e.dataset.offergroupApi||""}))}()},2634:function(){}},r={};function o(e){var n=r[e];if(void 0!==n)return n.exports;var a=r[e]={exports:{}};return t[e].call(a.exports,a,a.exports,o),a.exports}o.m=t,e=[],o.O=function(t,r,n,a){if(!r){var l=1/0;for(u=0;u<e.length;u++){r=e[u][0],n=e[u][1],a=e[u][2];for(var s=!0,i=0;i<r.length;i++)(!1&a||l>=a)&&Object.keys(o.O).every((function(e){return o.O[e](r[i])}))?r.splice(i--,1):(s=!1,a<l&&(l=a));if(s){e.splice(u--,1);var c=n();void 0!==c&&(t=c)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[r,n,a]},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,{a:t}),t},o.d=function(e,t){for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={279:0};o.O.j=function(t){return 0===e[t]};var t=function(t,r){var n,a,l=r[0],s=r[1],i=r[2],c=0;if(l.some((function(t){return 0!==e[t]}))){for(n in s)o.o(s,n)&&(o.m[n]=s[n]);if(i)var u=i(o)}for(t&&t(r);c<l.length;c++)a=l[c],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(u)},r=self.webpackChunkdjango_oscar_bluelight=self.webpackChunkdjango_oscar_bluelight||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var n=o.O(void 0,[121],(function(){return o(225)}));n=o.O(n)}();
//# sourceMappingURL=offergroups.js.map
